<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>commandunit</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

// For tabs
body {font-family: Arial;}

/* Style the tab */
.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}
</style>
</head>
<body>
<div class="tab">
<button class="tablinks" onclick="location.href='https://github.com/dakusui/commandunit';">
  <img src="resources/images/github.png" width="60px;20px" onclick="location.href = 'https://github.com/dakusui/commandunit';" align="middle"/>
</button>
<button class="tablinks" onclick="openTab(event, 'top')" id="defaultOpen">top</button>
<button class="tablinks" onclick="openTab(event, 'designConcept')">designConcept</button>
<button class="tablinks" onclick="openTab(event, 'designDetail')">designDetail</button>
<button class="tablinks" onclick="openTab(event, 'developmentGuide')">developmentGuide</button>
<button class="tablinks" onclick="openTab(event, 'faq')">faq</button>
<button class="tablinks" onclick="openTab(event, 'handbookCommandLine')">handbookCommandLine</button>
<button class="tablinks" onclick="openTab(event, 'handbookInstallation')">handbookInstallation</button>
<button class="tablinks" onclick="openTab(event, 'handbookProgramming')">handbookProgramming</button>
<button class="tablinks" onclick="openTab(event, 'systemRequirements')">systemRequirements</button>
</div>
<div id="designConcept" class="tabcontent">
<div id="designConcept_content">
<div class="sect1">
<h2 id="_yaml_not_gherkin">YAML, not Gherkin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gherkin is one notation widely used in "Cucumber"'s ecosystem.</p>
</div>
<div class="listingblock">
<div class="title">A Gherkin (Cucumber) Example</div>
<div class="content">
<pre class="highlight"><code class="language-gherkin" data-lang="gherkin">Feature: Guess the word

  # The first example has two steps
  Scenario: Maker starts a game
    When the Maker starts a game
    Then the Maker waits for a Breaker to join

  # The second example has three steps
  Scenario: Breaker joins a game
    Given the Maker has started a game with the word "silky"
    When the Breaker joins the Maker's game
    Then the Breaker must guess a word with 5 characters</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we write this in YAML, it will be like this:</p>
</div>
<div class="listingblock">
<div class="title">YAML version of Gherkin Example</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
Feature:
  Name: Guess the word <b class="conum">(1)</b>
  Scenarios:
  # The first example has two steps
  - Name: Maker starts a game
    When: the Maker starts a game
    Then: the Maker waits for a Breaker to join
  # The second example has three steps
  - Name: Breaker joins a game <b class="conum">(1)</b>
    Given: the Maker has started a game with the word "silky"
    When: the Breaker joins the Maker's game
    Then: the Breaker must guess a word with 5 characters</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;1&gt;: These attributes are introduced to define names of a feature and a scenario, which is defined without explicit attribute name in Gherkin.</p>
</div>
<div class="paragraph">
<p>Gherkin seems slightly simpler and cleaner since you will need fewer keywords, however, is it really worth adapting a dedicated notation not used anything but it?
By using Gherkin, you will need a set of plugins to support Gherkin for every tool used in a software development project such as browser, editor, or IDE.</p>
</div>
<div class="paragraph">
<p>If so, wouldn’t YAML be good enough to define your test cases?
isn’t YAML good enough, if we have a way to avoid repeating the same thing over and over again?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_given_when_then_structure">Given-When-Then structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>commandunit</code> has a similar syntax to other BDD (Beahvior Driven Development) testing tools such as "Cucumber"<a href="#cucumber-designConcept">[2]</a>.
It has three sections.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Given</dt>
<dd>
<p>A step that defines a procedure to prepare a state of system under test before starting a test’s main part.
This corresponds to "set up" phase in "four phase testing" model</p>
</dd>
<dt class="hdlist1">When</dt>
<dd>
<p>A step that interacts with the SUT.
This corresponds to "execute" phase in "four phase testing" model</p>
</dd>
<dt class="hdlist1">Then</dt>
<dd>
<p>A step that verifies the output and the state of the SUT.
This corresponds to "verify" phase in "four phase testing" model</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Following is one example of a test definition for <code>commandunit</code> in plain JSON.</p>
</div>
<div id="json-example-designConcept" class="listingblock">
<div class="title">JSON example</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "type": "NORMAL",
  "description": [],
  "given": {
    "description": [
      "This test should always be executed."
    ],
    "stdin": [],
    "shell": {
      "name": "bash",
      "options": [
        "-eu",
        "-E"
      ]
    },
    "source": [],
    "environmentVariables": {
      "COMMANDUNIT_DEPENDENCIES_ROOT": "/home/hiroshi/Documents/github/commandunit/out/main/scripts/dependencies"
    },
    "cmd": ":",
    "args": []
  },
  "when": {
    "description": [
      "Run 'array_contains' with the first argument contained by the rest."
    ],
    "stdin": [],
    "shell": {
      "name": "bash",
      "options": [
        "-eu",
        "-E"
      ]
    },
    "source": [
      "${COMMANDUNIT_DEPENDENCIES_ROOT}/bud/lib/arrays.rc"
    ],
    "environmentVariables": {
      "COMMANDUNIT_DEPENDENCIES_ROOT": "/home/hiroshi/Documents/github/commandunit/out/main/scripts/dependencies"
    },
    "cmd": "array_contains",
    "args": [
      "hello",
      "hello",
      "world"
    ]
  },
  "then": {
    "description": [],
    "exitCode": [
      "EQUAL",
      0
    ],
    "stdout": {
      "present": [],
      "absent": [
        "REGEX:.+"
      ]
    },
    "stderr": {
      "present": [],
      "absent": [
        "REGEX:.+"
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_powered_by_jq_front">Powered by <code>jq-front</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>jq-front</code> <a href="#jq-front-designConcept">[1]</a> is a tool to enable your JSON files to extend other JSON files.
Not only that it allows you to reference another node in the same file to compute a node’s value.</p>
</div>
<div class="paragraph">
<p>Test case definition tends to be repetitive, however, if we use <code>jq-front</code> to define common attribute values in <code>base/normal.json</code>, which can be used by other JSON files, it can be as simple as the following example.</p>
</div>
<div id="jsonpp-example-designConcept" class="listingblock">
<div class="title">JSON++ example</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "$extends": [
    "base/normal.json"
  ],
  "when": {
    "description": [
      "Run 'array_contains' with the first argument contained by the rest."
    ],
    "source": [
      "${COMMANDUNIT_DEPENDENCIES_ROOT}/bud/lib/arrays.rc"
    ],
    "cmd": "array_contains",
    "args": [
      "hello",
      "hello",
      "world"
    ]
  },
  "then": {
    "exitCode": [
      "EQUAL",
      0
    ],
    "stdout": {
      "absent": [
        "REGEX:.+"
      ]
    },
    "stderr": {
      "absent": [
        "REGEX:.+"
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>jq-front</code> renders this file into a normal JSON file, where the values defined inside <code>base/normal.json</code> are expended and then overridden by the values in <code>foo.json++</code> file.</p>
</div>
<div class="paragraph">
<p>It is a very flexible, yet still your files are JSON, as you see.
This means that you don’t need to find supports of the new format.
You can just keep using your favorite tools (editor, browser, IDE, etc) because in general they support popular formats such as JSON, YAML, or the good old XML.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_yaml_json_pipeline">YAML → JSON Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s go one step forward.
We use YAML in order to ensure the test case definitions readable for human.
We also use <code>jq-front</code>, which processes JSON files(<code>.json++</code>) and renders into normal JSON files.</p>
</div>
<div class="paragraph">
<p>In short, instead of coming up with a single notation that solves all the problems at once, it applies tools that solve them one by one.</p>
</div>
<div class="paragraph">
<p>Following is an example of a file that written in YAML, using <code>jq-front</code> 's feature.</p>
</div>
<div id="yamlpp-example-designConcept" class="listingblock">
<div class="title">YAML++ example, <code>test-contains_true.yaml++</code></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">"$extends":
  - base/normal.json
when:
  description:
    - Run 'array_contains' with the first argument contained by the rest.
  source:
    - ${COMMANDUNIT_DEPENDENCIES_ROOT}/bud/lib/arrays.rc
  cmd: array_contains
  args:
    - hello
    - hello
    - world
then:
  exitCode:
    - EQUAL
    - 0
  stdout:
    absent:
      - REGEX:.+
  stderr:
    absent:
      - REGEX:.+</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be converted into a JSON file (a .json++ file) that uses <code>jq-front</code> feature, which is shown as the <a href="#jsonpp-example-designConcept">JSON++ example</a>.
Then it can be converted into normal JSON file, shown as <a href="#json-example-designConcept">JSON example</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="jq-front-designConcept"/>[1] jq-front: JSON with inheritance and templating <a href="https://dakusui.github.io/jq-front/">dakusui.github.io/jq-front</a></p>
</li>
<li>
<p><a id="cucumber-designConcept"/>[2] Cucumber Testing and Collaboration tool <a href="https://cucumber.io/">cucumber.io</a></p>
</li>
</ul>
</div>
<div class="paragraph text-right">
<p><a href="index.html">top</a></p>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="designConcept.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="designDetail" class="tabcontent">
<div id="designDetail_content">
<div class="sect1">
<h2 id="_the_wrapper_script">The wrapper script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>commandunit</code> comes with a "wrapper" script that defines a bash function for you.
The function automatically downloads the specified version of <code>commandunit</code> from its repo and execute it.
If you specify a dockerized version of it, it downloads an image for it, if you specify non-dockerized ("native") version of it, it shallow-clones a branch in the repo for it.</p>
</div>
<div class="paragraph">
<p>It has two classes of options, which are "wrapper" options and normal options.
The former controls the behavior of the wrapper and the latter controls the <code>commandunit</code> self’s behavior.</p>
</div>
<div class="paragraph">
<p>For instance, you can specify a version of <code>commandunit</code> 's main part by <code>--version=…​</code>, which is one of wrapper options.
To specify tests to be executed by a regular expression you can ue <code>--filter=…​</code> option which is a normal option.</p>
</div>
<div class="paragraph">
<p>Check <a href="handbookCommandLine.adoc">Command Line Interface Handbook</a> for more detail.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_directory_layout">Directory Layout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default directory layout of <code>commandunit</code>-based project is designed to be compatible with Maven-based project<a href="#maven-designDetail">[1]</a>.</p>
</div>
<div class="listingblock">
<div class="title">Default Directory Layout</div>
<div class="content">
<pre class="highlight"><code>src/                                    <b class="conum">(1)</b>
  main/
    dependencies                        <b class="conum">(2)</b>
  test/                                 <b class="conum">(3)</b>
    .commandunit/                       <b class="conum">(4)</b>
      jsonpp/                           <b class="conum">(5)</b>
      testdrivers/                      <b class="conum">(6)</b>
    scripts/
target/
  commandunit/
    report/                             <b class="conum">(7)</b>
    work/                               <b class="conum">(8)</b>
      scripts/
        core/
          {testcase-1}.json
          {testcase-1}.json++
          {testcase-1}.yaml++</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Current directory (project root directory)</p>
</li>
<li>
<p>A directory under which "dependencies" are downloaded by the wrapper script.
Typically used for downloading "native" versions of <code>commandunit</code>.</p>
</li>
<li>
<p>A directory to store test scripts. (test script directory, can be changed through <code>--test-srcdir=</code> option)</p>
</li>
<li>
<p>A directory to store <code>commandunit</code> 's configuration. (test project configuration directory)
exported as <code>COMMANDUNIT_DIR</code> environment variable.
This can be configured through <code>--commandunit-dir</code> option.</p>
</li>
<li>
<p>A base directory from which files specified by <code>$extends</code> attribute are searched..</p>
</li>
<li>
<p>A base directory from which "driver" files are searched.</p>
</li>
<li>
<p>A directory to which <code>commandunit</code> writes report.
(report directory, can be changed through <code>--test-reportdir=</code> option)</p>
</li>
<li>
<p>A directory to which <code>commandunit</code> stores processed test scripts and intermediate files. (working directory, can be changed through <code>--test-workdir</code> option)</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commandunit_s_pipeline"><code>commandunit</code> 's Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following diagram illustrates data flows of the <code>commandunit</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="diag-ditaa-md5-9e8034756cbd5a16cd149a54e3857bbc.png" alt="Diagram" width="730" height="588"/>
</div>
<div class="title">Figure 1. The Processing Pipeline of the <code>commandunit</code></div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>preprocess</code> subcommand (2.1)</dt>
<dd>
<p>This step converts test case definitions into JSON files, which can be executed by the step that comes the next: <code>run</code> step.</p>
</dd>
<dt class="hdlist1"><code>run</code> subcommand (2.2)</dt>
<dd>
<p>This step runs the test case definitions.
Test result is accumulated in Result Repository</p>
</dd>
<dt class="hdlist1"><code>report</code> subcommand (2.3)</dt>
<dd>
<p>A step to compile human readable report from the output of the previous step (<code>run</code>).</p>
</dd>
<dt class="hdlist1">Test Repository</dt>
<dd>
<p>Specified by <code>--test-srcdir</code>.
A directory under which users store test definition files, typically <code>yaml++</code> files, as source.</p>
</dd>
<dt class="hdlist1">Compiled Test Repository</dt>
<dd>
<p>Specified by <code>--test-workdir</code>.
A directory under which files generated during the execution of <code>preprocessor</code> subcommand.</p>
</dd>
<dt class="hdlist1">Result Repository</dt>
<dd>
<p>Specified by <code>--test-reportdir</code>.
A directory under which test report files are stored.
Executor stores <code>testreport.json</code> here and report renderer reads it and generates <code>testreport.adoc</code> hre from the JSON file.</p>
</dd>
<dt class="hdlist1">Test Report</dt>
<dd>
<p><code>testreport.adoc</code></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="maven-designDetail"/>[1] Apache Maven Project <a href="https://maven.apache.org/">Apache Maven Project</a>: 2002-2022</p>
</li>
</ul>
</div>
<div class="paragraph text-right">
<p><a href="index.html">top</a></p>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="designDetail.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="developmentGuide" class="tabcontent">
<div id="developmentGuide_content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>commandunit</code> is developed on Linux Platform (Ubuntu22.04)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements">Requirements</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>bash</p>
</li>
<li>
<p>bashcov</p>
</li>
<li>
<p>docker + dockerd</p>
</li>
<li>
<p><a href="https://github.com/christian-korneck/docker-pushrm">docker-pushrm plugin</a></p>
</li>
<li>
<p>Ubuntu 22.04</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_sh"><code>build.sh</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Building, testing, generating doc, and releasing can be done with a script <code>build.sh</code>.
It takes an array of subcommands.
Subcommands can be classified into two groups, which are "grouped subcommands" and "basic subcommands".
A "grouped subcommand" is interpreted as a sequence of subcommands and executed by <code>build.sh</code> one by one.</p>
</div>
<div class="paragraph">
<p>If you don’t specify any subcommand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will be interpreted that <code><a href="#_build_2">BUILD</a></code> grouped subcommand is specified.</p>
</div>
<div class="sect2">
<h3 id="_basic_subcommands">Basic Subcommands</h3>
<div class="sect3">
<h4 id="_parameters">Parameters</h4>
<div class="paragraph">
<p>A basic subcommand can take parameters.
There are three targets: <code>source</code>, <code>snapshot</code>, and <code>release</code>.
<code>source</code> means that the subcommand handles source files.
For instance, if the target is <code>source</code>, the <code>test</code> subcommand uses source files for test.
If it is <code>snapshot</code>, a snapshot docker image will be used.
If <code>release</code>, a docker image to be released will be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="_build"><code>build</code></h4>
<div class="paragraph">
<p>Builds a docker image from a source.</p>
</div>
<div class="paragraph">
<p>Only <code>snapshot</code> and <code>release</code> can be specified for the first parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_clean"><code>clean</code></h4>
<div class="paragraph">
<p>Removes all the working files generated by this build script.
Note that files created by <code>generate-src</code> will not be removed since they are a part of the source tree, not working files.</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dummy"><code>dummy</code></h4>
<div class="paragraph">
<p>This subcommand does nothing.
Useful for testing a change made in <code>build.sh</code>.</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fail"><code>fail</code></h4>
<div class="paragraph">
<p>This subcommand fails always.
Useful for testing a change made in <code>build.sh</code>.</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coverage"><code>coverage</code></h4>
<div class="paragraph">
<p>This command executes test and generates a coverage report.
Generated coverage report will be found under <code>out/testreport-coverage</code> directory.</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_doc"><code>doc</code></h4>
<div class="paragraph">
<p>Generates documentation under working directory from asciidoc (.adoc) files under <code>OUTDIR/site/adoc</code> directory, whose contents are copied from <code>src/site/adoc</code> directory.
The generated documentation (<code>.html</code> files) will be found under <code>OUTDIR/doc</code> directory.</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generate_src"><code>generate-src</code></h4>
<div class="paragraph">
<p>A subcommand to generate "source" files based on project information such as the current target development version, repository URL, etc.
Typically executed at the last of <code>RELEASE</code> subcommand.</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prepare"><code>prepare</code></h4>
<div class="paragraph">
<p>Copies the source tree (<code>SRCDIR</code>) to the working directory (<code>OUTDIR</code>).</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_publish_doc"><code>publish-doc</code></h4>
<div class="paragraph">
<p>Pushes the generated documents to a branch of the git repository, the branch (<code>.repo.documentation.docbranch</code> attribute) and repository URL (<code>.repo.url</code> attribute) can be specified in <code>build_info.json</code>.</p>
</div>
<div class="paragraph">
<p>This subcommand doesn’t take any parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_push"><code>push</code></h4>
<div class="paragraph">
<p>Pushes a docker image to the docker repository.</p>
</div>
<div class="paragraph">
<p>The first parameter specifies <code>snapshot</code> or <code>released</code> image to be pushed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test"><code>test</code></h4>
<div class="paragraph">
<p>Executes unit test suites stored under <code>out/test/scripts</code>.</p>
</div>
<div class="paragraph">
<p>The first parameter specifies the type of the <code>commandunit</code> executable used for the test execution.
<code>source</code> means the scripts before dockerized,
<code>snapshot</code> is a docker image for snapshot, and <code>release</code> is a docker image to be released.</p>
</div>
</div>
<div class="sect3">
<h4 id="_release_precheck"><code>release-precheck</code></h4>
<div class="paragraph">
<p>Performs a "pre-check" for the entire release procedure.
It checks if there is no uncommitted changes, un-pushed commits, and you are on the <code>main</code> branch.</p>
</div>
</div>
<div class="sect3">
<h4 id="_release_postmortem"><code>release-postmortem</code></h4>
<div class="paragraph">
<p>Some files in the source tree of <code>commandunit</code> should be generated in an automated way, otherwise they will become redundant.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grouped_subcommands">Grouped Subcommands</h3>
<div class="paragraph">
<p>Grouped subcommands do not take any parameters.</p>
</div>
<div class="sect3">
<h4 id="_build_2">BUILD</h4>
<div class="paragraph">
<p>A basic "build" command.
It generates documentation and execute tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh BUILD</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included Subcommands</dt>
<dd>
<p><code>clean</code>, <code>prepare</code>, <code>doc</code>, and <code>test</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_doc_2">DOC</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh DOC</code></pre>
</div>
</div>
<div class="paragraph">
<p>A subcommand to build documentation under working directory.
Generated HTML files will be found under <code>out/doc</code> directory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included Subcommands</dt>
<dd>
<p><code>clean</code>, <code>prepare</code>, and <code>doc</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_test_2">TEST</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh TEST</code></pre>
</div>
</div>
<div class="paragraph">
<p>Executes the test suite.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included Subcommands</dt>
<dd>
<p><code>clean</code>, <code>prepare</code>, and <code>test</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_coverage_2">COVERAGE</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh COVERAGE</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included Subcommands</dt>
<dd>
<p><code>clean</code>, <code>prepare</code>, and <code>coverage</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_package">PACKAGE</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh PACKAGE</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included Subcommands</dt>
<dd>
<p><code>clean prepare</code>, <code>test:::true</code>, <code>build:snapshot</code>, and <code>test:snapshot::true</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_deploy">DEPLOY</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh DEPLOY</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included Subcommands</dt>
<dd>
<p><code>PACKAGE</code> and <code>push:snapshot</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_release">RELEASE</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh RELEASE</code></pre>
</div>
</div>
<div class="paragraph">
<p>A subcommand for releasing.
Note that a check will be done at the beginning of this subcommand.
If something not pushed on your local, this subcommand fails (<code>release-precheck</code>).
Also, note that documentation is not published by this subcommand, and you need to do it separately using <code>PUBLISH_DOC</code> subcommand.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Included Subcommands</dt>
<dd>
<p><code>clean</code>, <code>release-precheck</code>, <code>prepare</code>, <code>test:::true</code>, <code>build:release</code>, <code>test:release::true</code>, <code>push:release</code>, and <code>release-postmortem</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_publish_doc_2">PUBLISH_DOC</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./build.sh PUBLISH_DOC</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repository">Repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The source code repository of <code>commandunit</code> is found <a href="https://github.com/dakusui/commandunit">here</a>.</p>
</div>
<div class="sect2">
<h3 id="_tags">Tags</h3>
<div class="paragraph">
<p>Each released commit has a tag: <code>v{Major Version}.{Minor Version}</code>.
For the commit whose "wrapper script" was verified most recently has a tag <code>wrapper-verified</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_branches">Branches</h3>
<div class="paragraph">
<p>The documentation is stored in <code>docs</code> branch and exposed to the public through <a href="https://dakusui.github.io/commandunit/">dakusui.github.io/commandunit</a>.
Check also <a href="#_publish_doc_2">PUBLISH_DOC</a> subcommand of the build script.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_directory_structure">Directory Structure</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>PROJECT_BASEDIR/                                      <b class="conum">(1)</b>
  buildtools/          A directory for build tools.
  out/                 A directory for working files. <b class="conum">(2)</b>
    doc/                                              <b class="conum">(3)</b>
    main/
      scripts/                                        <b class="conum">(4)</b>
    site/
      adoc/                                           <b class="conum">(5)</b>
  src/                 A directory for source tree    <b class="conum">(6)</b>
    docker/
    main/
    site/
    test/
  build.sh             A build script for this project.
  build_info.json      A project definition file.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;1&gt;: project base directory.</p>
</li>
<li>
<p>&lt;2&gt;: Specified by environment variable <code>OUTDIR</code>.</p>
</li>
<li>
<p>&lt;3&gt;: <code>DOCDIR</code>.</p>
</li>
<li>
<p>&lt;4&gt;: <code>EXEC_BASEDIR</code>.</p>
</li>
<li>
<p>&lt;5&gt;: <code>DOC_SRCDIR</code>.</p>
</li>
<li>
<p>&lt;6&gt;: Specified by environment variable <code>SRCDIR</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_info_json"><code>build_info.json</code></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title"><code>build_info.json</code> example</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "projectName": "commandunit",
  "homepage": "https://github.com/dakusui/commandunit",
  "docker": {
    "user": "dakusui",
    "hostFsRootMountPoint": "/var/lib/commandunit"
  },
  "version": {
    "latestReleased": {
      "major": 1,
      "minor": 25
    },
    "target": {
      "major": 1,
      "minor": 26
    }
  },
  "repo": {
    "url": "https://github.com/dakusui/commandunit.git",
    "documentation": {
      "docbranch": "docs"
    },
    "release": {
      "branch": "main"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_time_environment_variables">Build-time Environment Variables</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>LATEST_RELEASED_VERSION</code></dt>
<dd>
<p>The most recent released version of this product.</p>
</dd>
<dt class="hdlist1"><code>TARGET_VERSION</code></dt>
<dd>
<p>The version currently under development.</p>
</dd>
<dt class="hdlist1"><code>PROJECT_NAME</code></dt>
<dd>
<p>The name of this project.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>PROJECT_BASEDIR</code></dt>
<dd>
<p>The path to the root directory of this project.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>HOMEPAGE</code></dt>
<dd>
<p>The URL of the project’s homepage.</p>
</dd>
<dt class="hdlist1"><code>SRCDIR</code></dt>
<dd>
<p>The path to the source directory (i.e., <code>${PROJECT_BASEDIR}/src</code>)
<code>OUTDIR</code>: The path to the working directory (i.e., <code>${PROJECT_BASEDIR}/out</code>)</p>
</dd>
<dt class="hdlist1"><code>EXEC_BASEDIR</code></dt>
<dd>
<p>The directory that holds executables of this product during the build-time. (i.e., <code>${PROJECT_BASEDIR}/out/main/scripts</code>)</p>
</dd>
<dt class="hdlist1"><code>DOCDIR</code></dt>
<dd>
<p>The directory to store generated documentations. (i.e., <code>${PROJECT_BASEDIR}/out/doc</code>)</p>
</dd>
<dt class="hdlist1"><code>DOCSRCDIR</code></dt>
<dd>
<p>The directory to store documentation source files during a build.  (i.e., <code>${PROJECT_BASEDIR}/out/doc</code>)</p>
</dd>
<dt class="hdlist1"><code>DOCKER_REPO_NAME</code></dt>
<dd>
<p>A name of docker repository name. (i.e., <code>{.docker.user}/{.project.name}</code>).</p>
</dd>
<dt class="hdlist1"><code>BUILD_HOSTFSROOT_MOUNTPOINT</code></dt>
<dd>
<p>A path under which the root directory of the host side file system "seems" mounted.
By prefixing this path to a host side path, you can calculate the corresponding path of it inside the docker container.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_known_problems">Known Problems</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>A build on macOS halts during <code>test</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="developmentGuide.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="faq" class="tabcontent">
<div id="faq_content">
<div class="sect1">
<h2 id="_commandunit_doesnt_work"><code>commandunit</code> doesn’t work</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">I am on a macOS and using <code>commandunit</code>, but a permission problem is reported</dt>
<dd>
<p>Currently, minikube + dockerized combination seems sometimes not working on macOS (<a href="https://github.com/dakusui/commandunit/issues/26">Issue-26</a>).
Please try native mode, if you see an error such as following:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO: Local repository path that has SSH Git URL ...
mkdir: cannot create directory '/tmp/bud': No space left on device
ERROR:(exit code:1, pipe status: 1):
  at /app/dependencies/bud/lib/core.rc:54 (abort)</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">I am on a macOS and using <code>commandunit</code> in "native" mode but it doesn’t work</dt>
<dd>
<p>In some conditions, <code>yaml2json</code> installed through <code>npm</code> doesn’t work <code>macOS</code> at all.
There are two workarounds.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install it through <code>brew</code></p>
</li>
<li>
<p>Install <code>yq</code> and create a wrapper script that invokes it with the name <code>yaml2json</code>.
The wrapper script should look like following:</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/usr/bin/env bash
yq -o=json "${@}"</pre>
</div>
</div>
<div class="paragraph">
<p>Place this file somewhere on the <code>PATH</code> environment variable.
(t.b.d.)</p>
</div>
<div class="paragraph">
<p>if macOS <code>yaml2json</code> doesn’t work. → Workaround</p>
</div>
<div class="paragraph">
<p><code>/opt/homebrew/bin/yaml2json</code> <code>0.3.0</code><a href="#jq-front-faq">[1]</a></p>
</div>
<div class="paragraph">
<p><code>none</code> subcommand.</p>
</div>
<div class="paragraph">
<p>macOS <code>yaml2json</code> doesn’t work.</p>
</div>
<div class="sect2">
<h3 id="_references">References</h3>
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="jq-front-faq"/>[1] jq-front: JSON with inheritance and templating <a href="https://dakusui.github.io/jq-front/">dakusui.github.io/jq-front</a></p>
</li>
</ul>
</div>
<div class="paragraph text-right">
<p><a href="index.html">top</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="faq.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="handbookCommandLine" class="tabcontent">
<div id="handbookCommandLine_content">
<div class="sect1">
<h2 id="_command_line_options">Command Line Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following is the description of command line options of <code>commandunit</code>.</p>
</div>
<div id="commandLineOptions" class="literalblock">
<div class="title">Command Line Options</div>
<div class="content">
<pre class="nowrap">$ commandunit --help
Usage: commandunit [WRAPPER OPTION]... [--] [OPTION]... [SUBCOMMAND]...

A wrapper function for 'commandunit' to invoke its docker image.
Followings are switching options to control the wrapper's behaviour.
Options not listed here or ones after the separator (--) are passed to the docker image directly.

Wrapper options: <b class="conum">(1)</b>
--native            Use the 'native' version of commandunit.  <b class="conum">(2)</b>
--version={VERSION} Use the specified version of commandunit. If 'snapshot' is given, a version under development is used (default: v1.24).
--debug-shell       Get the shell of the docker image. Type Ctrl-D to quit it. Development purpose only.
                    <b class="conum">(3)</b>
--show-image-name   Print the image name. Useful to figure out the version.
--quit              Quit before running the image. With --show-image-name, useful to figure out the image version
--help              Show this help and pass the --help option to the docker image.
--                  A separator to let this wrapper know the options after it should be passed directly to the image

Usage: commandunit [OPTION]... [SUBCOMMAND]...

Runs tests.

Sub-commands: <b class="conum">(4)</b>
  preprocess:
    Preprocesses test definition files (yaml++, yaml, and json++) and convert them into executable JSON test files
  run:
    Runs tests under a directory specified by --test-workdir and writes a report file: testreport.json under a
    directory specified by --test-reportdir.
  report:
    Reads a file testreport.json under directory specified by --test-reportdir and renders a report file (testreport.adoc)
    under the same directory.
  none:
    Does nothing.

Options: (* - for development use only)

 -h, --help            show this help
 -p, --parallel        execute the tests in parallel
 -f, --filter          filter tests with the specified regular expression(default:'.*')
     --commandunit-dir directory to store config and data files (default: {test-srcdir}/.commandunit)
     --project-name    set project name of the test execution. used as the report's title(default:'unknown')
     --test-srcdir     specify directory under which tests are stored (default: current directory/src/test)
     --test-workdir    specify directory under which commandunit writes internal data* (default: current directory + /target/commandunit/work)
     --test-reportdir  write test reports under the specified directory* (default: current directory + /target/commandunit/report)
     --ignore-mtime    ignore mtime and forcibly compile tests <b class="conum">(5)</b>
     --clean           clean working directory
     --tapview         show test progress with 'tapview'

Examples:
  commandunit                      Run tests found under current directory in sequential mode.
  commandunit --test-srcdir=DIR    Run tests found under DIR in sequential mode.
  commandunit --test-srcdir=DIR -p Run tests found under DIR in parallel mode.

- Test Anything Protocol: &lt;https://testanything.org/&gt;
- documentation: &lt;https://dakusui.github.io/commandunit/&gt;
- github project: &lt;https://github.com/dakusui/bud&gt;
- tapview: &lt;https://gitlab.com/esr/tapview&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;1&gt;: Check <a href="#_wrapper_options_and_normal_options">Wrapper Options and Normal Options</a> section for more detail.</p>
</li>
<li>
<p>&lt;2&gt;: "native" mode means an execution mode of <code>commandunit</code>, where it is executed without using docker. Check <a href="#sectionNativeExecution">"Native" execution</a> for more Detail.</p>
</li>
<li>
<p>&lt;3&gt;: This option gives you a shell inside the docker image of <code>commandunit</code>.
Values environment variables are guaranteed to be the same as the ones, when you execute it without this position.</p>
</li>
<li>
<p>&lt;4&gt;: Check <a href="#_sub_commands">Sub-commands</a> section for more detail.</p>
</li>
<li>
<p>&lt;5&gt;: Forcibly <code>commandunit</code> preprocesses the test source files and intermediate files.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wrapper_options_and_normal_options">Wrapper Options and Normal Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described in the <a href="designDetail.html">Design Detail</a>, <code>commandunit</code> comes with its "wrapper" script.
The wrapper has its own options, and it interprets command line arguments as wrapper options, first.
If <code>--</code> is present and any non-valid wrapper option is found before it, an error will be reported and <code>commandunit</code> will quit with non-0 exit code.
The arguments that cannot be interpreted as wrapper options will be passed to the <code>commandunit</code> 's main part.
The main part parses them as "normal" options using <code>getopt</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sectionNativeExecution">"Native" execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to use <code>commandunit</code> without Docker solutions.
The mode is called "native" mode, although it is executed as a bash script, not a binary executable.</p>
</div>
<div class="paragraph">
<p>To execute <code>commandunit</code> in native mode, you can just give <code>--native</code> wrapper option to its command line.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sub_commands">Sub-commands</h2>
<div class="sectionbody">
<div id="commandUnitPipeline" class="imageblock">
<div class="content">
<img src="diag-ditaa-md5-c9f4208029262f7814157794bc63f46e.png" alt="Diagram" width="730" height="588"/>
</div>
<div class="title">Figure 1. The Processing Pipeline of the <code>commandunit</code></div>
</div>
<div class="paragraph">
<p>As described in the <a href="#commandLineOptions">Command Line Options</a>, <code>commandunit</code> has four subcommands, which are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>preprocess</code></p>
</li>
<li>
<p><code>execute</code></p>
</li>
<li>
<p><code>report</code></p>
</li>
<li>
<p><code>none</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>preprocess</code>, <code>execute</code>, and <code>report</code> correspond to the actions 2.1, 2.2, and 2.3 respectively in the diagram:<a href="#commandUnitPipeline">The Processing Pipeline of the <code>commandunit</code></a>,
<code>none</code> does nothing, and it is useful to use in combination with <code>--clean</code> option, which removes all the generated files in the project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ commandunit --clean none</code></pre>
</div>
</div>
<div class="paragraph text-right">
<p><a href="index.html">top</a></p>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="handbookCommandLine.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="handbookInstallation" class="tabcontent">
<div id="handbookInstallation_content">
<div class="sect1">
<h2 id="_commandunit_installation_handbook"><code>commandunit</code>: Installation Handbook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Place the following script in one of directories on your <code>PATH</code> environment variable and give <code>755</code> permission (<code>chmod 755</code>).</p>
</div>
<div class="listingblock">
<div class="title">commandunit</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash

function __commandunit_exec_commandunit() {
  export PROJECT_BASE_DIR="${PWD}"
  export COMMANDUNIT_PWD="${PROJECT_BASE_DIR}" # Referenced by commandunit itself.
  export COMMANDUNIT_SOURCE_DIR="${PROJECT_BASE_DIR}/src/dependencies/commandunit"
  export COMMANDUNIT_DEFAULT_VERSION="${COMMANDUNIT_DEFAULT_VERSION:-v1.29}"
  export BUD_DEBUG=enabled
  function __commandunit_user_option() {
    case "$(uname -sr)" in

    Darwin*)
      echo -n "-u" "1000:1000"
      ;;

    Linux*Microsoft*)
      echo -n "-u" "$(id -u):$(id -g)"
      ;;

    Linux*)
      echo -n "-u" "$(id -u):$(id -g)"
      ;;

    CYGWIN* | MINGW* | MSYS*)
      echo -n "-u" "$(id -u):$(id -g)"
      ;;

    # Add here more strings to compare
    # See correspondence table at the bottom of this answer

    *)
      echo -n "-u" "$(id -u):$(id -g)"
      ;;
    esac
  }
  function __commandunit_exec_commandunit_docker() {
    local _image_name="${1}"
    shift
    # shellcheck disable=SC2086
    # shellcheck disable=SC2046
    docker run \
      $(__commandunit_user_option) \
      --env COMMANDUNIT_PWD="${_project_basedir}" \
      --env COMMANDUNIT_LOGLEVEL="${_loglevel}" \
      --env TMPDIR="/tmp" \
      -v "${_project_basedir}:${_hostfsroot_mountpoint}${_project_basedir}" \
      ${_entrypoint} \
      -i "${_image_name}" \
      "${@}"
  }
  function __commandunit_clean_cloned_commandunit() {
    local _version_name="${1}" _source_dir="${2:-${COMMANDUNIT_SOURCE_DIR}}"
    #      +-- Safeguard for a bug, where the variable becomes empty.
    #     |    Because this function removes everything under the dir.
    #     V
    if [[ "${_source_dir}/${_version_name}" == *"/src/dependencies/"* ]]; then
      if [[ -d "${_source_dir}/${_version_name}" ]]; then
        rm -fr "${_source_dir"?"}/${_version_name:?}"
      fi
    fi
  }
  function __commandunit_clone_commandunit() {
    local _git_tag_option="${1}" _version_name="${2}"
    local _out
    # shellcheck disable=SC2086
    _out="$(git clone --depth 1 ${_git_tag_option} https://github.com/dakusui/commandunit.git "${COMMANDUNIT_SOURCE_DIR}/${_version_name}" 2&gt;&amp;1)" || {
      echo "Failed to clone&lt;: ${_out}&gt;" &gt;&amp;2
      return 1
    }
  }
  function __commandunit_exec_commandunit_native() {
    local _version_name="${1}"
    shift
    "${COMMANDUNIT_SOURCE_DIR}/${_version_name}/src/main/scripts/bin/commandunit-main" "${@}"
  }

  local _project_basedir="${PROJECT_BASE_DIR}"
  local _hostfsroot_mountpoint="/var/lib/commandunit"
  local _docker_repo_name="dakusui/commandunit"
  local _entrypoint=""
  local _native="no"
  local _loglevel="${COMMANDUNIT_LOGLEVEL:-ERROR}"
  local _image_name _image_version="${COMMANDUNIT_DEFAULT_VERSION}" _branch_name="main" _version_name=${COMMANDUNIT_DEFAULT_VERSION} _args _show_image_name=false _i _s _quit=false _help=false
  _args=()
  _s=to_func
  for _i in "${@}"; do
    if [[ "${_s}" == to_func ]]; then
      if [[ $_i == "--version="* ]]; then
        local _v="${_i#*=}"
        if [[ "${_v}" == "snapshot" ]]; then
          # _image_version="${COMMANDUNIT_VERSION%.*}.$((${COMMANDUNIT_VERSION##*.} + 1))"
          local _default_version="${COMMANDUNIT_DEFAULT_VERSION}" # e.g. v1.24
          _image_version="${_default_version%.*}.$((${_default_version##*.} + 1))"
        else
          _branch_name="${_v}"
          _image_version="${_v}"
        fi
        _version_name="${_v}"
        # --version=      snapshot               v1.99          (none)
        # _version_name   snapshot               v1.99           v1.24
        # _image_version  v1.25                  v1.99           v1.24          (private)
        # _image_name     dakusui:v1.25-snapshot dakusui:v1.99   dakusui:v1.24
        # _branch_name    main                   v1.99           v1.24
      elif [[ $_i == "--native" ]]; then
        _native="yes"
      elif [[ $_i == "--debug-shell" ]]; then
        _entrypoint="--entrypoint=/bin/bash"
      elif [[ $_i == "--show-image-name" ]]; then
        _show_image_name=true
      elif [[ $_i == "--quit" ]]; then
        _quit=true
      elif [[ $_i == "--help" ]]; then
        _help=true
        _args+=("${_i}")
      elif [[ $_i == "--" ]]; then
        _s=to_container
      else
        _args+=("${_i}")
      fi
    else
      _args+=("${_i}")
    fi
  done
  _image_name="${_docker_repo_name}:${_image_version}"
  if [[ "${_version_name}" == "snapshot" ]]; then
    _image_name="${_image_name}-${_v}"
  fi
  if ${_show_image_name}; then
    echo "${_image_name}"
  fi
  if ${_help}; then
    echo "Usage: commandunit [WRAPPER OPTION]... [--] [OPTION]... [SUBCOMMAND]..."
    echo ""
    echo "A wrapper function for 'commandunit' to invoke its docker image.".
    echo "Followings are switching options to control the wrapper's behaviour."
    echo "Options not listed here or ones after the separator (--) are passed to the commandunit implementation directly."
    echo ""
    echo "Wrapper options:"
    echo "--native            Use the 'native' version of commandunit."
    echo "--version={VERSION} Use the specified version of commandunit. If 'snapshot' is given, a version under development is used (default: ${COMMANDUNIT_DEFAULT_VERSION})."
    echo "--debug-shell       Get the shell of the docker image. Type Ctrl-D to quit it. Development purpose only."
    echo "--show-image-name   Print the image name. Useful to figure out the version."
    echo "--quit              Quit before running the image. With --show-image-name, useful to figure out the image version"
    echo "--help              Show this help and pass the --help option to the docker image."
    echo "--                  A separator to let this wrapper know the options after it should be passed directly to the image"
    echo ""
  fi
  ${_quit} &amp;&amp; return 0
  if [[ "${_native}" == "no" ]]; then
    __commandunit_exec_commandunit_docker "${_image_name}" "${_args[@]}"
  else
    which jq-front &gt; /dev/null || {
      function jq-front() {
        docker run --rm -i \
          -v "${HOME}:/var/lib/jf/${HOME}" \
          -e JF_PATH_BASE="/var/lib/jf" \
          -e JF_PATH="${JF_PATH}" \
          -e JF_DEBUG=${JF_DEBUG:-disabled} \
          -e JF_CWD="$(pwd)" \
          -e COMMANDUNIT_DEPENDENCIES_ROOT="${COMMANDUNIT_DEPENDENCIES_ROOT:?Required environment variable is not set.}" \
          -e COMMANDUNIT_BUILTIN_ROOT="${COMMANDUNIT_DEPENDENCIES_ROOT:?Required environment variable is not set.}" \
          dakusui/jq-front:"${JF_DOCKER_TAG:-v0.53}" "${@}"
      } &amp;&amp;
      export -f jq-front
    }
    if [[ "${_version_name}" ==  "snapshot" ]]; then
      # Remove already loaded one, then... do clone
      __commandunit_clean_cloned_commandunit "${_version_name}"
    fi
    if [[ ! -e "${COMMANDUNIT_SOURCE_DIR}/${_version_name}" ]]; then
      __commandunit_clone_commandunit "--branch ${_branch_name}" "${_version_name}"
    fi
    __commandunit_exec_commandunit_native "${_version_name}" "${_args[@]}"
  fi
}

function main() {
  __commandunit_exec_commandunit "${@}"
}

main "${@}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or download it from <a href="resources/examples/commandunit">here</a>.</p>
</div>
<div class="paragraph text-right">
<p><a href="index.html">top</a></p>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="handbookInstallation.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="handbookProgramming" class="tabcontent">
<div id="handbookProgramming_content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This is a manual that provides useful information to write your own test cases using <code>commandunit</code> 's functionalities.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_syntax">Syntax</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_given_when_and_then_structure"><code>given</code>, <code>when</code>, and <code>then</code> structure</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>given</code></dt>
<dd>
<p>You can define an action which should be executed before <code>when</code> clause.
If the execution of this clause fails, i.e., if it results in non-0 exit code, the rest of the test (<code>when</code> and <code>then</code> clauses) will not be executed.
This corresponds to the "set-up" phase in "four phase testing" model.</p>
</dd>
<dt class="hdlist1"><code>when</code></dt>
<dd>
<p>You can define an action whose behavior should be tested in this clause.
This section has the same structure as the <code>given</code> clause.
This corresponds to the "execute" phase in "four phase testing" model.</p>
</dd>
<dt class="hdlist1"><code>then</code></dt>
<dd>
<p>This clause defines a check to be exercised for the result of <code>when</code> clause.
This corresponds to the "verify" phase in "four phase testing" model.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As discussed later in this section, it is advised to a built-in test template: <code>base/normal.json</code> directly or indirectly always.
If no preparation is necessary for your test, you do not need to define anything for <code>given</code> clause explicitly as long as you are extending it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_attribute"><code>type</code> attribute</h3>
<div class="paragraph">
<p><code>commandunit</code> specifies the structure of a test case, which has <code>given</code>, <code>when</code>, and <code>then</code>.
However, the syntax inside the <code>given</code> and <code>when</code> clauses is user customizable, although it doesn’t need to be modified under usual usages.
If you specify a value of <code>type</code> attribute <code>NORMAL</code>, it searches for handler functions from <code>json_NORMAL.rc</code> and <code>scripttest.rc</code> files.
These <code>.rc</code> files are placed under test drivers directories.
Test driver directories are under the <code>{commandunit-dir}/.commandunit/testdrivers</code> and <code>{commandunit-home}/src/main/scripts/lib/testdrivers</code>.
<code>commandunit</code> searches for the files from them in this order.</p>
</div>
<div class="paragraph">
<p>Therefore, syntax inside <code>given</code> and <code>when</code> clauses can be differently defined based on the <code>type</code> attribute value.
However, the only built-in currently available (<code>base/normal.json</code>) uses the <code>NORMAL</code> type, and it has sufficiently general-purposed design, we discuss the syntax defined by the <code>NORMAL</code> type in the rest of this document unless otherwise explicitly noted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_given_and_when_clauses"><code>given</code> and <code>when</code> clauses</h3>
<div class="paragraph">
<p><code>given</code> and <code>when</code> clauses have the same structure, and you can use the same set of attributes for them.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>description</code> (array)</dt>
<dd>
<p>This part is included as a comment in the auto-generated test script.</p>
</dd>
<dt class="hdlist1"><code>environmentVariables</code> (object)</dt>
<dd>
<p>An object that specifies environment variables and their values.
Those environment variables can be referenced from inside the elements in <code>args</code> array.</p>
</dd>
<dt class="hdlist1"><code>source</code> (array)</dt>
<dd>
<p>Files to be sourced by the <code>shell</code>.</p>
</dd>
<dt class="hdlist1"><code>stdin</code> (array)</dt>
<dd>
<p>An array of string, which gives to the executed command from <code>stdin</code>.</p>
</dd>
<dt class="hdlist1"><code>shell</code> (object)</dt>
<dd>
<p>A shell with which a command specified by <code>cmd</code> and <code>args</code>.</p>
</dd>
<dt class="hdlist1"><code>cmd</code> (string)</dt>
<dd>
<p>A command to be executed.
A function in sourced files (see <code>source</code>) can also be specified.</p>
</dd>
<dt class="hdlist1"><code>args</code> (array)</dt>
<dd>
<p>Arguments to be passed to the command specified by <code>cmd</code> attribute.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>given</code> clause should be used to "set up" test fixture, while <code>when</code> clause should be used for executing the command under target itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="_then_clause"><code>then</code> clause</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>exitCode</code> (array)</dt>
<dd>
<p>An array that defines a condition which the exit code of the command line specified by <code>when</code> clause should satisfy.
The first element is a name of a predicate and the rest of the element are arguments to be passed to the predicate.
Currently available predicates are, <code>EQUAL</code> and <code>NOT_EQUAL</code>.
<code>[EQUAL, 0]</code> is satisfied if and only if the exit code of the command in the <code>when</code> clause was <code>0</code>.
<code>[NOT_EQUAL, 0]</code> is satisfied if and only if the exit code of the command in the <code>when</code> clause was not <code>0</code>.</p>
</dd>
<dt class="hdlist1"><code>stdout</code> and <code>stderr</code> (object)</dt>
<dd>
<p>Under these attributes, you can define regular expressions that should and should not be present in them.
To define a check which examines if <code>stdout</code> contains a regular expression: <code>Hello world</code>, you can do:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>  stdout:
    present:
      - REGEX:Hello world</pre>
</div>
</div>
<div class="paragraph">
<p>Also, to define a check, <code>stderr</code> doesn’t contain anything, you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  stderr:
    absent:
      - REGEX:.+</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_built_ins">Built-ins</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_built_in_test_templates_basenormal_json">Built-in Test Templates: <code>base/normal.json</code></h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>base/normal.json</code></dt>
<dd>
<p>A basic test base file.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>commandunit</code> has a built-in JSON file, <code>base/normal.json</code>, which you can extend to define your own tests.</p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="listingblock">
<div class="title">base/normal.json</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "type": "NORMAL",
  "description": [
  ],
  "given": {
    "description": [
      "This test should always be executed."
    ],
    "stdin": [
    ],
    "shell": {
      "name": "bash",
      "options": [
        "-eu",
        "-E"
      ]
    },
    "source": [
    ],
    "environmentVariables": {
      "COMMANDUNIT_BUILTIN_ROOT": "eval:string:${COMMANDUNIT_DEPENDENCIES_ROOT}"
    },
    "cmd": ":",
    "args": [
    ]
  },
  "when": {
    "description": [
    ],
    "stdin": [
    ],
    "shell": {
      "name": "bash",
      "options": [
        "-eu",
        "-E"
      ]
    },
    "source": [
    ],
    "environmentVariables": {
      "COMMANDUNIT_BUILTIN_ROOT": "eval:string:${COMMANDUNIT_DEPENDENCIES_ROOT}"
    },
    "cmd": "eval:string:$(error 'missing attribute!')",
    "args": [
    ]
  },
  "then": {
    "description": [
    ],
    "exitCode": [
      "EQUAL",
      0
    ],
    "stdout": {
      "present": [
      ],
      "absent": [
      ]
    },
    "stderr": {
      "present": [
      ],
      "absent": [
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>As you see, it defines attributes the framework commonly uses and their default values.
In this file, <code>type</code> attribute at the top level is defined <code>NORMAL</code> and therefore, this file will be handled by functions defined in <code>json_NORMAL.rc</code>.</p>
</div>
<div class="paragraph">
<p>The following is an example of the usage of <code>base/normal.json</code>.</p>
</div>
<div class="listingblock">
<div class="title">Test Case Example</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
"$extends":
  - base/normal.json
when:
  environmentVariables:
    SCRIPTS_DIR: "${COMMANDUNIT_PROJECT_DIR}/src/main/scripts" <b class="conum">(1)</b>
  source:
    - ${COMMANDUNIT_BUILTIN_ROOT}/bud/lib/core.rc
    - ${SCRIPTS_DIR}/target_lib.rc                             <b class="conum">(1)</b>
  cmd: cat
  args:
    - ${SCRIPTS_DIR}/hello.txt
then:
  exitCode:
    - EQUAL
    - 0
  stdout:
    present:
      - REGEX:Hello world
  stderr:
    absent:
      - REGEX:.+</code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;1&gt;: <code>environmentVariable</code> array is designed to be evaluated at the beginning of <code>given</code> and <code>when</code> clause.
Thus, you can reference the environment variables in the <code>source</code> and <code>args</code> arrays.</p>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_libraries">Built-in Libraries</h3>
<div class="paragraph">
<p><code>commandunit</code> comes with built-in libraries.</p>
</div>
<div class="paragraph">
<p>Functions listed in this section are guaranteed to be compatible across <code>commandunit</code> versions.
They are called "public functions".
In case you find any incompatibility in them, please file a bug ticket.
However, the libraries are  also used by the <code>commandunit</code> itself and some of them are designed for internal use only.
Specifications of such internal functions may be changed in future, and it is advised not to use them.</p>
</div>
<div class="paragraph">
<p>To use the public functions, you first need to <code>source</code> it using an environment variable <code>COMMANDUNIT_BUILTIN_ROOT</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">source "${COMMANDUNIT_BUILTIN_ROOT}/bud/lib/core.rc"</code></pre>
</div>
</div>
<div class="paragraph">
<p>public functions are defined one of the following libraries.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bud/lib/core.rc</code>:: Core functions such as printing message to <code>stderr</code>.</p>
</li>
<li>
<p><code>bud/lib/arrays.rc</code>:: Functions to handle array data.</p>
</li>
<li>
<p><code>bud/lib/json.rc</code>:: Functions to handle/create JSON nodes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that only functions listed in this section are public.
The other functions found in the libraries above are not public and designed for internal use of <code>commandunit</code>.
Programmatically, you can use such non-public functions, but their compatibilities are not guaranteed and you need to use them at your own risk.</p>
</div>
<div class="sect3">
<h4 id="_budlibcore_rc"><code>bud/lib/core.rc</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">message</dt>
<dd>
<p>Prints given arguments to <code>stderr</code>.</p>
</dd>
<dt class="hdlist1">assert_that</dt>
<dd>
<p>do <code>eval</code> for the second and the following arguments.
If it resulted in non-zero exit code, the first and the value passed to the <code>eval</code> will be printed in <code>stderr</code> and then the process will be aborted.</p>
</dd>
<dt class="hdlist1">print_stacktrace</dt>
<dd>
<p>Prints a current stack trace to <code>stderr</code>.</p>
</dd>
<dt class="hdlist1">abort</dt>
<dd>
<p>Aborts the current process with exit code <code>1</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_budlibarrays_rc"><code>bud/lib/arrays.rc</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">join_by</dt>
<dd>
<p>Joins the second and the following arguments joining with the first argument.
The resulting string will be printed to <code>stdout</code>.</p>
</dd>
<dt class="hdlist1">array_contains</dt>
<dd>
<p>Search for the first argument from the second and the following argument.
The search is done by using a <code>grep -q -E</code> command.
If no element matches the keyword(the first argument), non-0 value will be returned based on <code>grep</code> command’s behavior.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_budlibjson_rc"><code>bud/lib/json.rc</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1">to_json_array</dt>
<dd>
<p>Converts given arguments in to a JSON array.</p>
</dd>
<dt class="hdlist1">json_value_at</dt>
<dd>
<p>Prints a JSON node found at the path specified by the second argument in the JSON node specified by the first argument.</p>
</dd>
<dt class="hdlist1">json_has_key</dt>
<dd>
<p>Checks if a key (second argument) is found at the path (third argument. If omitted, <code>.</code> will be used) in a JSON object given by the first argument.
If and only if input is well-formed JSON and the key is found, <code>true</code> will be printed.
If the input is well-formed JSON but the key doesn’t exist, <code>false</code> will be printed.
If the input is not well-formed, non-0 value will be returned.</p>
</dd>
<dt class="hdlist1">json_type_of</dt>
<dd>
<p>Prints a type of JSON node specified by the first argument.
The type will be one of: <code>object</code>, <code>array</code>, <code>string</code>, <code>number</code>, and <code>null</code>
If non-welformed JSON node is given, the execution will be aborted.</p>
</dd>
<dt class="hdlist1">json_object_merge</dt>
<dd>
<p>"Merges" two JSON objects specified by the first and the second arguments.
If the same key exists in both the first and second arguments, the one from the second will override the one from the other.</p>
</dd>
<dt class="hdlist1">json_array_append</dt>
<dd>
<p>Prints an array created by appending a JSON array specified by the second argument to another specified by the first argument.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_environment_variables">Built-in Environment Variables</h3>
<div class="paragraph">
<p>The se environment variables can be used in your test cases without explicit declaration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">COMMANDUNIT_PROJECT_DIR</dt>
<dd>
<p>The top level directory of you project.
The actual value can be different depending on whether you are using <code>commandunit</code> in "native" mode or not.</p>
</dd>
<dt class="hdlist1">COMMANDUNIT_BUILTIN_ROOT</dt>
<dd>
<p>The directory under which built-ins are stored.
It points a directory under <code>{commandunit-home}/src/main/scripts/lib</code></p>
</dd>
</dl>
</div>
<div class="paragraph text-right text-right">
<p><a href="index.html">top</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="handbookProgramming.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="systemRequirements" class="tabcontent">
<div id="systemRequirements_content">
<div class="sect1">
<h2 id="_software_components">Software Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>commandunit</code> is tested on following platforms.</p>
</div>
<div class="sect2">
<h3 id="_on_linux">On Linux</h3>
<div class="ulist">
<ul>
<li>
<p>Distribution: Ubuntu 22.04</p>
</li>
<li>
<p><code>bash</code>: GNU bash, version 5.1.16(1)-release (x86_64-pc-linux-gnu)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_dockerized_mode">Dockerized mode</h4>
<div class="ulist">
<ul>
<li>
<p>git (tested with 2.34.1)</p>
</li>
<li>
<p><code>dockerd</code>: ???</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_native_mode">"native" mode</h4>
<div class="ulist">
<ul>
<li>
<p><code>git</code>: (tested with 2.34.1)</p>
</li>
<li>
<p><code>jq-front</code>: <code>0.54</code>, Dockerized</p>
</li>
<li>
<p><code>jq</code>: <code>jq-1.5-1-a5b5cbe</code> or later</p>
</li>
<li>
<p><code>yaml2json</code>: <code>0.3.0</code>, installed through <code>npm install yamljs</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_macos_x86_64">On macOS (x86_64)</h3>
<div class="ulist">
<ul>
<li>
<p><code>bash</code>: GNU bash, version 5.1.12(1)-release (x86_64-apple-darwin20.6.0)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_dockerized_mode_2">Dockerized mode</h4>
<div class="ulist">
<ul>
<li>
<p><code>docker</code>: Docker version 23.0.5, build bc4487a (macOS)</p>
</li>
<li>
<p><code>dockerd</code>: minikube version: v.1.31.2</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_native_mode_2">"native" mode</h4>
<div class="ulist">
<ul>
<li>
<p><code>git</code>:  git version 2.39.1</p>
</li>
<li>
<p><code>jq-front</code>: <code>0.54</code>, Dockerized</p>
</li>
<li>
<p><code>jq</code>: <code>jq-1.6</code></p>
</li>
<li>
<p><code>yaml2json</code>: yq (<a href="https://github.com/mikefarah/yq/" class="bare">https://github.com/mikefarah/yq/</a>) version v4.35.2 with a wrapper script[<a href="#yaml2jsonWrapper-faq">yam2json</a>].</p>
</li>
</ul>
</div>
<div id="yaml2jsonWrapper-faq" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cat $(which yaml2json)
#!/usr/bin/env bash
yq -o=json "${@}"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_macos_apple_silicon">On macOS (Apple Silicon)</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Dockerized mode</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>git (tested with 2.34.1)</p>
</li>
<li>
<p><code>docker</code>: Docker version 23.0.5, build bc4487a (macOS)</p>
</li>
<li>
<p><code>dockerd</code>: Docker Desktop 4.19.0 (106363)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">"native" mode</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>git (tested with 2.34.1)</p>
</li>
<li>
<p><code>jq-front</code> (<code>0.54</code>, Dockerized)</p>
</li>
<li>
<p><code>jq</code> (<code>jq-1.6</code>)</p>
</li>
<li>
<p><code>yaml2json</code> (<code>0.3.0</code>, installed through <code>brew</code>, not through <code>npm</code>)</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph text-right">
<p><a href="index.html">top</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="systemRequirements.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<div id="top" class="tabcontent">
<div id="top_content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>commandunit</code> is a pluggable and flexible testing framework (test harness), whose testing description language is based on "JSON" (and "YAML") format.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Automated tests can become easily repetitive and not uniformed very often.
<code>commandunit</code> addresses this problem for your UNIX-based CLI tools.
It allows you to define your test cases in YAML but with the help of <code>jq-front</code><a href="#jq-front">[1]</a>.
With this tool, your test will look like this:</p>
</div>
<div class="listingblock">
<div class="title">test-contains_true.yaml++</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
"$extends":
  - base/normal.json
when:
  description:
    - Run 'array_contains' with the first argument contained by the rest.
  source:
    - /path/to/arrays.rc
  cmd: array_contains
  args:
    - hello
    - hello
    - world
then:
  exitCode:
    - EQUAL
    - 0
  stdout:
    absent:
      - REGEX:.+
  stderr:
    absent:
      - REGEX:.+</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_concept">Design Concept</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Test definitions are repetitive.
But any single test is not (should not be) identical to any other one.
In generic programming languages have features, we can address it with their features such  user define functions, data types, inheritance, and others.
Those are not available in popular data notations.
<code>commandunit</code> doesn’t try to solve it by itself, but by using <code>jq-front</code><a href="#jq-front">[1]</a>, it separates this concern from the test management and execution model.</p>
</div>
<div class="paragraph">
<p>For more detail, check <a href="designConcept.html">Design Concept</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_detail">Design Detail</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To implement the concepts shown in the previous section, <code>commandunit</code> has a pipeline that takes <code>jq-front</code> powered yaml as its input and produces JSON files that defines test cases.</p>
</div>
<div class="paragraph">
<p>For more detail, check <a href="designDetail.html">Design Detail</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_system_requirements">System Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the requirements of <code>commandunit</code> for your system (or software components and their version used in testing of <code>commandunit</code>), check <a href="systemRequirements.html">System Requirements</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_manuals">User Manuals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_manual">Installation Manual</h3>
<div class="paragraph">
<p>You can install <code>commandunit</code> easily with its "wrapper" script.
Check <a href="https://github.com/dakusui/commandunit-installer">Installer</a> site.
For more details of installation, please check <a href="handbookInstallation.html">Installation and Quick Start Manual</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_manual">Command-line Manual</h3>
<div class="paragraph">
<p><code>commandunit</code> comes with a "wrapper" script, which abstracts an invocation step of it so that "native" mode and "dockerized" mode look the same.
The wrapper has its own options.</p>
</div>
<div class="paragraph">
<p>For the detail of <code>commandunit</code> 's options the wrapper’s options, check <a href="handbookCommandLine.html">Command Line Manual</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_programming_manual">Programming Manual</h3>
<div class="paragraph">
<p>Like JUnit and other testing tools, <code>commandunit</code> has its own programming model.
Also, it assumes a directory structure, which is designed to be compatible with Maven<a href="#maven">[2]</a>.</p>
</div>
<div class="paragraph">
<p>You can start using <code>commandunit</code> by cloning, trying and modifying an example project.
But for more details, such as syntax of the tool, you can check <a href="handbookProgramming.html">Programming Manual</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq">FAQ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The list of frequently asked questions and their answers is available here: <a href="faq.html">FAQ</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="jq-front"/>[1] jq-front project in github.org. <a href="https://github.com/dakusui/jq-front">jq-front</a>: 2019</p>
</li>
<li>
<p><a id="maven"/>[2] Apache Maven Project <a href="https://maven.apache.org/">Apache Maven Project</a>: 2002-2022</p>
</li>
<li>
<p><a id="asciidocfx"/>[3] Asciidoc Book Editor based on JavaFX 18 <a href="https://asciidocfx.com/">Asciidoc Book Editor based on JavaFX 18</a>: 2022</p>
</li>
<li>
<p><a id="intellij"/>[4] IntelliJ IDEA <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>: 2000-2022</p>
</li>
<li>
<p><a id="asciidoc-intellij-plugin"/>[5] Asciidoctor Intellij Plugin Project <a href="https://plugins.jetbrains.com/plugin/7391-asciidoc">Asciidoctor Intellij Plugin Project</a>: 2022</p>
</li>
<li>
<p><a id="asciidoc2html"/>[6] Generate HTML from AsciiDoc <a href="https://docs.asciidoctor.org/asciidoctor/latest/html-backend/">Generate HTML from AsciiDoc</a>: 2022</p>
</li>
<li>
<p><a id="gherkin"/>[7] Gherkin Reference <a href="https://cucumber.io/docs/gherkin/reference/">Gherkin</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="paragraph text-right"><p>
<a href="top.html" target="_blank">open this page in a new window</a>
</p></div>
</div>
<script>
function openTab(evt, cityName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(cityName).style.display = "block";
  evt.currentTarget.className += " active";
}

// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();

</script>
</body>
</html>
